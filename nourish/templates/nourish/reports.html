{% extends "nourish/base.html" %}

{% load facebook_tags %}
{% load nourish %}
{% load media %}

{% block sitetitle %}Reports for {{ object.name }}{% endblock %}

{% block main-css %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="/static/resources/css/ext-all-gray.css">
{% endblock %}

{% block content-css %}
  {{ block.super }}
  <style>
    #site_content {
      width:900px;
      margin-left: 120px;
      float: none;
    }
  </style>
{% endblock %}

<!-- Remove the sidebar from the screen -->
{% block mainsidebar %}{% endblock %}

{% block preload_js %}
  {{ block.super }}
  <script type="text/javascript" src="/static/js/ext-all.js"></script>
  {% include_media 'reports.js' %}

  <script type="text/javascript">
    var registeredGuests = [ ];
    var admins = [ ];
    var adminString = [ ];
    
    {% for guest in guest_list %}
      admins[{{ guest.eg.group.id }}] = [];
      adminString[{{ guest.eg.group.id }}] = "";
      {% for admin in guest.eg.group.admins %}
        admins[{{ guest.eg.group.id }}].push({
          "name": "{{ admin.get_profile.fullname|escapejs }}",
          "email": "{{ admin.email }}",
          "dateJoined": "{{ admin.date_joined|date:"d M Y" }}"
        });
        adminString[{{ guest.eg.group.id }}] += '{{ admin.get_profile.fullname|escapejs|default:" " }} {% if admin.email != "" %}&lt;<a href="mailto:{{ admin.email }}"">{{ admin.email }}</a>&gt;{% endif %}'
      {% endfor %}

      registeredGuests.push({
        "id" : "{{ guest.eg.group.id }}",
        "name" : "{{ guest.eg.group.name|escapejs }}",
        "url" : "{% nurl guest.eg %}",
        "invite": '{{ guest.inv|default:"" }}',
        "confirmed": '{{ guest.con|default:"" }}',
        "admins" : admins[{{ guest.eg.group.id }}],
        "adminString" : adminString[{{ guest.eg.group.id }}]
      });
    {% endfor %}

    var registeredHosts = [ ];
    var hostAdmins = [ ];
    var hostAdminString = [ ];

    {% for host in host_list %}
      hostAdmins[{{ host.eg.group.id }}] = [];
      hostAdminString[{{ host.eg.group.id }}] = "";
      {% for admin in host.eg.group.admins %}
        hostAdmins[{{ host.eg.group.id }}].push({
          "name": "{{ admin.get_profile.fullname|escapejs }}",
          "email": "{{ admin.email }}"
        });
        hostAdminString[{{ host.eg.group.id }}] += '{{ admin.get_profile.fullname|escapejs|default:" " }} {% if admin.email != "" %}&lt;<a href="mailto:{{ admin.email }}"">{{ admin.email }}</a>&gt;{% endif %}'
      {% endfor %}

      registeredHosts.push({
        "id" : "{{ host.eg.group.id }}",
        "name" : "{{ host.eg.group.name|escapejs }}",
        "url" : "{% nurl host.eg %}",
        "invite": '{{ host.inv|default:"" }}',
        "confirmed": '{{ host.con|default:"" }}',
        "admins" : hostAdmins[{{ host.eg.group.id }}],
        "adminString" : hostAdminString[{{ host.eg.group.id }}]
      });
    {% endfor %}

    var unconfirmedGuests = [ ];
    var ugAdmins = [];
    var ugAdminString = [];

    {% for eg, count in unconfirmed_guests.items %}
      ugAdmins[{{ eg.group.id }}] = [];
      ugAdminString[{{ eg.group.id }}] = "";
      {% for admin in eg.group.admins %}
        ugAdmins[{{ eg.group.id }}].push({
          "name": "{{ admin.get_profile.fullname|escapejs }}",
          "email": "{{ admin.email }}"
        });
        ugAdminString[{{ eg.group.id }}] += '{{ admin.get_profile.fullname|escapejs|default:" " }} {% if admin.email != "" %}&lt;<a href="mailto:{{ admin.email }}"">{{ admin.email }}</a>&gt;{% endif %}'
      {% endfor %}

      unconfirmedGuests.push({
        "id" : "{{ eg.group.id }}",
        "name" : "{{ eg.group.name|escapejs }} ({{count}} unconfirmed)",
        "url" : "{% nurl eg %}",
        "admins" : ugAdmins[{{ eg.group.id }}],
        "adminString" : ugAdminString[{{ eg.group.id }}]
      });
    {% endfor %}

  </script>
{% endblock %}
{% block content %}
  <div style="float:left">
  <a href="/">
    <img border="0" src="/static/fta/FeedTheArtistsLogo.png">
  </a>
  </div>

  <div style="float:left; padding: 15px 0 0 20px; width: 500px">
    <h2>Reports for {{ object.name }}</h2>

    <br/>
    <p>
      <a href="{% nurl event %}" style="float: right">
        <img src="/static/images/leftArrow.png" style="vertical-align:middle"/>
        &nbsp;Go back to event page
      </a>
    </p>
  </div>

  <div style="clear: both; padding-bottom: 10px"></div>

  <div id="registeredGuests" style="padding: 15px 0 50px 0">
  </div>

  <div id="registeredHosts" style="padding: 15px 0 50px 0">
  </div>

  <div id="unconfirmedGuests" style="padding: 15px 0 50px 0">
  </div>

  <div id="noMealArtists" style="padding: 15px 0 50px 0">
  </div>

  <div id="noInviteThemeCamp" style="padding: 15px 0 50px 0">
  </div>


{% endblock %}

