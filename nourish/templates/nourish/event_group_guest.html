{% load nourish %} 

<h3>About Us</h3>
<p>{{ object.group.description }}</p>
<h3 style="display:inline;">Meals</h3>
{% if is_admin %}
  <span style="font-size: small;">[<a href="{% nurl object %}meals/">Edit Meals</a>]</span>
{% endif %}
<br><br>
{% for eg in host_event_groups %}
  <a href="{% nurl object.event %}invite/?guest={{object.id}}&host={{eg.id}}">Invite {{object.group.name}} to dinner with {{ eg.group.name }}</a>
  <br>
{% endfor %}
<table class="meals" width="100%">
  <tr><th class="first"></th><th>State</th><th>Crew</th><th>Notes</th></tr>
  {% for meal in meals %}
    <tr class="meal">
      <th rowspan=2 class="first">{{ meal.date|date:"N j" }} <em>({{ meal.date|date:"D." }})</em></th>
      <td>
        {% if meal.state == 'N' %}Posted{% endif %}
        {% if meal.state == 'I' %}Invited{% endif %}
        {% if meal.state == 'S' %}Selected{% endif %}
        {% if meal.state == 'C' %}Confirmed{% endif %}
      </td>
      <td>{{ meal.members}}</td>
      <td>{% if meal.features %}<strong>Restrictions</strong>; {% endif %}{{ meal.notes }}</td>
    </tr>
    <tr class="invites"><td colspan=4>
      {% if not meal.state = 'N' %}
        {% if meal.state = 'C' %}Dining with {% endif %}
        {% if meal.state = 'S' %}Pending reservation with {% endif %}
        {% if meal.state = 'I' %}Invitations from  {% endif %}
        <ul style="list-style: none; display: inline; margin: 0; padding: 0;">
          {% for invite in invites_rcvd %}
            {% if invite.meal = meal and invite.state != 'R' %}
              {% if meal.state != 'S' or invite = meal.invite %}
                <li style="display: inline; margin: 0; padding: 0;">
                  <a href="{% nurl invite.host_eg %}">{{ invite.host_eg.group.name }}</a> </em>
                </li>
              {% endif %}
            {% endif %}
          {% endfor %}
        </ul>
      {% endif %}
    </td></tr>
  {% endfor %}
</table>
