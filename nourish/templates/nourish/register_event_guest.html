{% extends "nourish/base.html" %}
{% load nourish %}
{% block title %}Register an Artist Group at {{event.name}}{% endblock %}
{% block content %}
  {% if canvas and not user.is_authenticated %}
    {% include "nourish/authorize_connect.html" %}
  {% else %}
    <h2>Register an Artists Group at {{event.name}}</h2>
    <p>This page is for artist groups that would like to be invited to dinner at {{event.name}}.</p>

    {% if not user.is_authenticated and not request.GET.u %}
      {% include "nourish/please_connect.html" %}
    {% else %}
      <form method="post">{% csrf_token %}
        {{ user_formset.management_form }}
        {{ group_formset.management_form }}
        {{ meal_formset.management_form }}

        {% if not user.is_authenticated %} 
          <h3>Info about you</h3>
          <p>We presume that you are the person who will be coordinating meals for your theme camp.  We need the information below so that we can contact you with updates about your invites, as well as other FtA-related communications.  Plus, you'll need to be able to log back into the site later to confirm your invitations, etc.</p>
          {{ user_formset.0.non_field_errors }}
          <table class="regform">
            {% include "nourish/form_snippet.html" with form=user_formset.0 %}
          </table>
        {% endif %}


        {% if is_fb %}
          {% if group_formset.0.group.field.choices %}
            <h3>Pick an artist group</h3>
            <p>We have found the following groups in your Facebook profile that might be your art project.  If your art project isn't in the list below, keep reading...</p>
            <table class="regform">
              {{ group_formset.0.non_field_errors }}
              {% include "nourish/group_form_snippet.html" with form=group_formset.0 %}
            </table>
            <h3>What if my {{type}} has no Facebook presence?</h3>
            <ul>
              <li><a href="{% nurl 'fb-newgroup-options' %}">Create a new facebook page</a></li>
              <li><a href="?nofb">Continue without creating a Facebook page for your group</a></li>
            </ul>
          {% else %}
          {% include "nourish/fb_newgroup_options.html" with type="theme camp" %}
          <ul>
            <li><a href="?nofb">Continue without creating a Facebook page for your group</a></li>
          </ul>
          {% endif %}
        {% else %}
          <h3>Info about your group.</h3>
          <p>Tell us a little bit about your group in general</p>
          {{ group_formset.0.non_field_errors }}
          <table class="regform">
            {% include "nourish/form_snippet.html" with form=group_formset.0 %}
          </table>
        {% endif %}

        {% if group_formset.0.group.field.choices or not is_fb %}
          <h3>Meals</h3>
        <p>Here's where you tell us how many crew members are looking for dinner each night of the event. Please specify each night that there will be crew with special dietary restrictions.  If your crew is not available for one of the dates, just leave it blank.  Note: By registering the nights you are available, you are not guaranteed a meal.  A theme camp must invite you.</p>
            <table border=0 class="regtable">
              {{ meal_formset.non_field_errors }}
              <tr><th>Date</th><th>Crew</th><th>Restrictions</th><th>Notes</th></tr>
              {% for form in meal_formset %}
                {% if form.non_field_errors %}
                  <tr><td colspan=2>{{ form.non_field_errors }}</td></tr>
                {% endif %}
              <tr>
                <td class="regdate">{{ dates.next|date:"N j" }} <em>({{ days.next|date:"D." }})</em>{{ form.date }}{% for field in form.hidden_fields %}{{ field }}{% endfor %}</td>
                <td>{{ form.members.errors }} {{ form.members }}</td>
                <td class="features">{{ form.features.errors }} {{ form.features }}</td>
                <td>{{ form.notes.errors }} {{ form.notes }}</td>
              </tr>
            {% endfor %}
          </table>
          <input type="submit" value="Register" />
        {% endif %}
      </form>
    {% endif %}
  {% endif %}
{% endblock %}
