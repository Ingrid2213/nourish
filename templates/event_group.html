{% extends "base.html" %}
{% load nourish %}

{% block title %}{{ object.group.name }} at {{ object.event.name }}{% endblock %}

{% block content %}
    {% if object.group.image_url %}
        <div style="float: left; margin-right: 5px;"><a href="{% nurl object.group %}"><img width=100 src="{{object.group.image_url}}?type=normal" border=0></a></div>
    {% endif %}
    {% if object.event.image_url %}
        <div style="float: left; margin-right: 5px;"><a href="{% nurl object.event %}"><img width=100 src="{{object.event.image_url}}?type=normal" border=0></a></div>
    {% endif %}
    <div style="float: left; width: 350px;">
    <h3 style="display: inline;"><a href="{% nurl object.group %}">{{ object.group.name }}</a></h3>
    {% if is_group_admin %}
    [<a href="{% nurl object.group %}edit/">Edit Group</a>]
    {% endif %}
    <br>
    <h4 style="display: inline;">at <a href="{% nurl object.event %}">{{object.event.name}}</a></h4>
    {% if is_event_admin %}
    [<a href="{% nurl object.event %}edit/">Edit Event</a>]
    {% endif %}
    <br>
{{ object.event.start_date }} thru {{ object.event.end_date }}<br>
    </div>
    <div style="clear: both;"></div>


    {% if object.group.role == 'A' %}
        <h3>About Us</h3>
        <p>{{ object.group.description }}</p>
        <h3 style="display:inline;">Meals</h3>
        {% if is_admin %}
            <span style="font-size: small;">[<a href="{% nurl object %}meals/">Edit Meals</a>]</span>
        {% endif %}
        <br><br>
        {% for eg in host_event_groups %}
            <a href="{% nurl object %}invite/{{eg.id}}">Invite {{object.group.name}} to dinner with {{ eg.group.name }}</a><br>
        {% endfor %}
        <table class="meals" width="100%">
        <tr><th class="first"></th><th>State</th><th>Crew</th><th>Notes</th></tr>
        {% for meal in meals %}
            <tr class="meal">
            <th rowspan=2 class="first">{{ meal.date|date:"N j" }} <em>({{ meal.date|date:"D." }})</em>
            <td>
            {% if meal.state == 'N' %}Posted{% endif %}
            {% if meal.state == 'I' %}Invited{% endif %}
            {% if meal.state == 'S' %}Selected{% endif %}
            {% if meal.state == 'C' %}Confirmed{% endif %}
            </td>
            <td>{{ meal.members}}</td>
            <td>{% if meal.features %}<strong>Restrictions</strong>; {% endif %}{{ meal.notes }}</td>
            </tr>
            <tr class="invites"><td colspan=4>
                {% if not meal.state = 'N' %}
                {% if meal.state = 'C' %}Dining with {% endif %}
                {% if meal.state = 'S' %}Pending reservation with {% endif %}
                {% if meal.state = 'I' %}Invitations from  {% endif %}
                <ul style="list-style: none; display: inline; margin: 0; padding: 0;">
                {% for invite in invites_rcvd %}
                    {% if invite.meal = meal and invite.state != 'R' %}
                     {% if meal.state != 'S' or invite = meal.invite %}
                        <li style="display: inline; margin: 0; padding: 0;"><a href="{% nurl invite.host_eg %}">{{ invite.host_eg.group.name }}</a> </em>
                         </li>
                     {% endif %}
                    {% endif %}
                {% endfor %}
                </ul>
                {% endif %}
            </td></tr>
        {% endfor %}
        </table>
    {% endif %}
    {% if object.role == 'T' %}
        <h3>Invitations</h3>
        {% if is_group_admin %}
            <a href="{% nurl object %}invites/">Manage Invitations</a>
        {% endif %}
        <table class="meals">
        <tr><th class="first"></th><th>Invitations</th></tr>
        {% for date in dates %}
            {% if 1 %}
            <tr class="meal">
            <th class="first">{{date}}</th>
            <td>
            <ul style="margin: 2px; padding: 0; list-style: none;">
            {% for invite in invites_sent %}
                {% if invite.date == date %}
                <li><a href="{% nurl invite.guest_eg %}">{{invite.guest_eg.group.name}}</a> <em>({{invite.meal.members}} diners)</em> -
                {% if invite.state == 'N' %}
                    <strong>Pending</strong>
                {% endif %}
                {% if invite.state == 'S' %}
                    <strong>Selected</strong>
                {% endif %}
                {% if invite.state == 'C' %}
                    <strong>Confirmed</strong>
                {% endif %}
                {% if invite.state == 'R' %}
                    <strong>Declined</strong>
                {% endif %}
                </li>
                {% endif %}
            {% endfor %}
            {% if is_group_admin %}
                <li><a href="{% nurl object.event %}">Invite Artists to Dinner!</a></li>
            {% endif %}
            {% endif %}
            </ul>
        {% endfor %}
        </tr>
    {% endif %}
    </table>

{% endblock %}
